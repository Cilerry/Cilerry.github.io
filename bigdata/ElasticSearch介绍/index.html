<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ElasticSearch介绍 | RedLeavesBlog</title><meta name="keywords" content="ElasticSearch"><meta name="author" content="Snow Monster"><meta name="copyright" content="Snow Monster"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="Elasticearch概述什么是搜索？百度：我们比如说想找寻任何的信息的时候，就会上百度去搜索一下，比如说找一部自己喜欢的电影，或者说找一本喜欢的书，或者找一条感兴趣的新闻（提到搜索的第一印象）。百度!&#x3D; 搜索 1）互联网的搜索：电商网站，招聘网站，新闻网站，各种app 2）IT系统的搜索：OA软件，办公自动化软件，会议管理，日程管理，项目管理。 搜索，就是在任何场景下，找寻你想要的信息，这个时">
<meta property="og:type" content="article">
<meta property="og:title" content="ElasticSearch介绍">
<meta property="og:url" content="http://www.red0819.top/bigdata/ElasticSearch%E4%BB%8B%E7%BB%8D/index.html">
<meta property="og:site_name" content="RedLeavesBlog">
<meta property="og:description" content="Elasticearch概述什么是搜索？百度：我们比如说想找寻任何的信息的时候，就会上百度去搜索一下，比如说找一部自己喜欢的电影，或者说找一本喜欢的书，或者找一条感兴趣的新闻（提到搜索的第一印象）。百度!&#x3D; 搜索 1）互联网的搜索：电商网站，招聘网站，新闻网站，各种app 2）IT系统的搜索：OA软件，办公自动化软件，会议管理，日程管理，项目管理。 搜索，就是在任何场景下，找寻你想要的信息，这个时">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.red0819.top/wordPic/timg.jpg">
<meta property="article:published_time" content="2020-07-18T03:02:11.000Z">
<meta property="article:modified_time" content="2020-09-23T07:50:34.842Z">
<meta property="article:author" content="Snow Monster">
<meta property="article:tag" content="ElasticSearch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.red0819.top/wordPic/timg.jpg"><link rel="shortcut icon" href="/img/logo.png"><link rel="canonical" href="http://www.red0819.top/bigdata/ElasticSearch%E4%BB%8B%E7%BB%8D/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="yandex-verification" content="{&quot;theme_color&quot;:{&quot;enable&quot;:true,&quot;main&quot;:&quot;\t#191970&quot;,&quot;paginator&quot;:&quot;#00c4b6&quot;,&quot;button_hover&quot;:&quot;#FF7242&quot;,&quot;text_selection&quot;:&quot;#00c4b6&quot;,&quot;link_color&quot;:&quot;#99a9bf&quot;,&quot;meta_color&quot;:&quot;#858585&quot;,&quot;hr_color&quot;:&quot;#A4D8FA&quot;,&quot;code_foreground&quot;:&quot;#F47466&quot;,&quot;code_background&quot;:&quot;rgba(27, 31, 35, .05)&quot;,&quot;toc_color&quot;:&quot;#00c4b6&quot;,&quot;blockquote_padding_color&quot;:&quot;#49b1f5&quot;,&quot;blockquote_background_color&quot;:&quot;#49b1f5&quot;}}"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '4.2.1',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-09-23 15:50:34'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = 'false'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="RedLeavesBlog" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/AF67D2ECB3B0F647193CD90F94294167.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">29</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">22</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Elasticearch概述"><span class="toc-number">1.</span> <span class="toc-text">Elasticearch概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是搜索？"><span class="toc-number">1.1.</span> <span class="toc-text">什么是搜索？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如果用数据库做搜索会怎么样？"><span class="toc-number">1.2.</span> <span class="toc-text">如果用数据库做搜索会怎么样？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是全文检索和Lucene？"><span class="toc-number">1.3.</span> <span class="toc-text">什么是全文检索和Lucene？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是Elasticsearch？"><span class="toc-number">1.4.</span> <span class="toc-text">什么是Elasticsearch？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Elasticsearch的适用场景"><span class="toc-number">1.5.</span> <span class="toc-text">Elasticsearch的适用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Elasticsearch的特点"><span class="toc-number">1.6.</span> <span class="toc-text">Elasticsearch的特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Elasticsearch的核心概念"><span class="toc-number">1.7.</span> <span class="toc-text">Elasticsearch的核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#近实时"><span class="toc-number">1.7.1.</span> <span class="toc-text">近实时</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cluster（集群）"><span class="toc-number">1.7.2.</span> <span class="toc-text">Cluster（集群）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Node（节点）"><span class="toc-number">1.7.3.</span> <span class="toc-text">Node（节点）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Index（索引-数据库）"><span class="toc-number">1.7.4.</span> <span class="toc-text">Index（索引-数据库）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Type（类型-表）"><span class="toc-number">1.7.5.</span> <span class="toc-text">Type（类型-表）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Document（文档-行）"><span class="toc-number">1.7.6.</span> <span class="toc-text">Document（文档-行）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Field（字段-列）"><span class="toc-number">1.7.7.</span> <span class="toc-text">Field（字段-列）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mapping（映射-约束）"><span class="toc-number">1.7.8.</span> <span class="toc-text">Mapping（映射-约束）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ElasticSearch与数据库的类比"><span class="toc-number">1.7.9.</span> <span class="toc-text">ElasticSearch与数据库的类比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ElasticSearch存入数据和搜索数据机制"><span class="toc-number">1.7.10.</span> <span class="toc-text">ElasticSearch存入数据和搜索数据机制</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Elasticsearch快速入门"><span class="toc-number">2.</span> <span class="toc-text">Elasticsearch快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装包下载"><span class="toc-number">2.1.</span> <span class="toc-text">安装包下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Elasticsearch安装"><span class="toc-number">2.2.</span> <span class="toc-text">Elasticsearch安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Elasticsearch操作工具"><span class="toc-number">2.3.</span> <span class="toc-text">Elasticsearch操作工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#浏览器"><span class="toc-number">2.3.1.</span> <span class="toc-text">浏览器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux命令行"><span class="toc-number">2.3.2.</span> <span class="toc-text">Linux命令行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kibana的Dev-Tools"><span class="toc-number">2.3.3.</span> <span class="toc-text">Kibana的Dev Tools</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Elasticsearch使用"><span class="toc-number">3.</span> <span class="toc-text">Elasticsearch使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#数据类型"><span class="toc-number">3.1.</span> <span class="toc-text">数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#核心数据类型"><span class="toc-number">3.1.1.</span> <span class="toc-text">核心数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#复杂数据类型"><span class="toc-number">3.1.2.</span> <span class="toc-text">复杂数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#地理位置数据类型"><span class="toc-number">3.1.3.</span> <span class="toc-text">地理位置数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#专用类型"><span class="toc-number">3.1.4.</span> <span class="toc-text">专用类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mapping"><span class="toc-number">3.2.</span> <span class="toc-text">Mapping</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#手动创建"><span class="toc-number">3.2.1.</span> <span class="toc-text">手动创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自动创建"><span class="toc-number">3.2.2.</span> <span class="toc-text">自动创建</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IK分词器"><span class="toc-number">3.3.</span> <span class="toc-text">IK分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#为什么使用分词器"><span class="toc-number">3.3.1.</span> <span class="toc-text">为什么使用分词器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IK分词器安装"><span class="toc-number">3.3.2.</span> <span class="toc-text">IK分词器安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IK分词器测试"><span class="toc-number">3.3.3.</span> <span class="toc-text">IK分词器测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#检索文档"><span class="toc-number">3.4.</span> <span class="toc-text">检索文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#元数据查询"><span class="toc-number">3.4.1.</span> <span class="toc-text">元数据查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#全文档检索"><span class="toc-number">3.4.2.</span> <span class="toc-text">全文档检索</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#协议方法-索引-类型-search"><span class="toc-number">4.</span> <span class="toc-text">协议方法 索引&#x2F;类型&#x2F;_search</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#字段全值匹配检索"><span class="toc-number">4.0.1.</span> <span class="toc-text">字段全值匹配检索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字段分词匹配检索"><span class="toc-number">4.0.2.</span> <span class="toc-text">字段分词匹配检索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字段模糊匹配检索"><span class="toc-number">4.0.3.</span> <span class="toc-text">字段模糊匹配检索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#聚合检索"><span class="toc-number">4.0.4.</span> <span class="toc-text">聚合检索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分页检索"><span class="toc-number">4.0.5.</span> <span class="toc-text">分页检索</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#索引别名-aliases"><span class="toc-number">4.1.</span> <span class="toc-text">索引别名 _aliases</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建索引别名"><span class="toc-number">4.1.1.</span> <span class="toc-text">创建索引别名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查询别名"><span class="toc-number">4.1.2.</span> <span class="toc-text">查询别名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除某个索引的别名"><span class="toc-number">4.1.3.</span> <span class="toc-text">删除某个索引的别名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#为某个别名进行无缝切换"><span class="toc-number">4.1.4.</span> <span class="toc-text">为某个别名进行无缝切换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查询别名列表"><span class="toc-number">4.1.5.</span> <span class="toc-text">查询别名列表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#索引模板"><span class="toc-number">4.2.</span> <span class="toc-text">索引模板 </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#常见的场景-分割索引"><span class="toc-number">4.2.1.</span> <span class="toc-text">常见的场景: 分割索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建模板"><span class="toc-number">4.2.2.</span> <span class="toc-text">创建模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看系统中已有的模板清单"><span class="toc-number">4.2.3.</span> <span class="toc-text">查看系统中已有的模板清单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看某个模板详情"><span class="toc-number">4.2.4.</span> <span class="toc-text">查看某个模板详情</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API操作"><span class="toc-number">4.3.</span> <span class="toc-text">API操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#写数据"><span class="toc-number">4.3.1.</span> <span class="toc-text">写数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#读数据"><span class="toc-number">4.3.2.</span> <span class="toc-text">读数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kibana"><span class="toc-number">5.</span> <span class="toc-text">Kibana</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(/wordPic/timg.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">RedLeavesBlog</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">ElasticSearch介绍</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2020-07-18T03:02:11.000Z" title="undefined 2020-07-18 11:02:11">2020-07-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/bigdata/">大数据</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>30分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="Elasticearch概述"><a href="#Elasticearch概述" class="headerlink" title="Elasticearch概述"></a>Elasticearch概述</h1><h2 id="什么是搜索？"><a href="#什么是搜索？" class="headerlink" title="什么是搜索？"></a>什么是搜索？</h2><p>百度：我们比如说想找寻任何的信息的时候，就会上百度去搜索一下，比如说找一部自己喜欢的电影，或者说找一本喜欢的书，或者找一条感兴趣的新闻（提到搜索的第一印象）。百度<br>!= 搜索</p>
<p>1）互联网的搜索：电商网站，招聘网站，新闻网站，各种app</p>
<p>2）IT系统的搜索：OA软件，办公自动化软件，会议管理，日程管理，项目管理。</p>
<p>搜索，就是在任何场景下，找寻你想要的信息，这个时候，会输入一段你要搜索的关键字，然后就期望找到这个关键字相关的有些信息。</p>
<h2 id="如果用数据库做搜索会怎么样？"><a href="#如果用数据库做搜索会怎么样？" class="headerlink" title="如果用数据库做搜索会怎么样？"></a>如果用数据库做搜索会怎么样？</h2><p><img src="/bigdata/ElasticSearch%E4%BB%8B%E7%BB%8D/1.png" alt="1"></p>
<p>用数据库来实现搜索，是不太靠谱的。通常来说，性能会很差的。</p>
<h2 id="什么是全文检索和Lucene？"><a href="#什么是全文检索和Lucene？" class="headerlink" title="什么是全文检索和Lucene？"></a>什么是全文检索和Lucene？</h2><p>1）全文检索，倒排索引</p>
<p>全文检索是指计算机索引程序通过扫描文章中的每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置，当用户查询时，检索程序就根据事先建立的索引进行查找，并将查找的结果反馈给用户的检索方式。这个过程类似于通过字典中的检索字表查字的过程。全文搜索搜索引擎数据库中的数据。</p>
<p><img src="/bigdata/ElasticSearch%E4%BB%8B%E7%BB%8D/2.png" alt="2"></p>
<p>2）lucene，就是一个jar包，里面包含了封装好的各种建立倒排索引，以及进行搜索的代码，包括各种算法。我们就用java开发的时候，引入lucene jar，然后基于lucene的api进行去进行开发就可以了。</p>
<h2 id="什么是Elasticsearch？"><a href="#什么是Elasticsearch？" class="headerlink" title="什么是Elasticsearch？"></a>什么是Elasticsearch？</h2><p>Elasticsearch，基于Lucene，隐藏复杂性，提供简单易用的RestfulAPI接口、JavaAPI接口（还有其他语言的API接口）。</p>
<p>关于Elasticsearch的一个传说，有一个程序员失业了，陪着自己老婆去英国伦敦学习厨师课程。程序员在失业期间想给老婆写一个菜谱搜索引擎，觉得Lucene实在太复杂了，就开发了一个封装了Lucene的开源项目：Compass。后来程序员找到了工作，是做分布式的高性能项目的，觉得Compass不够，就写了Elasticsearch，让Lucene变成分布式的系统。</p>
<p>Elasticsearch是一个实时分布式搜索和分析引擎。它用于全文搜索、结构化搜索、分析。</p>
<p>全文检索：将非结构化数据中的一部分信息提取出来,重新组织,使其变得有一定结构,然后对此有一定结构的数据进行搜索,从而达到搜索相对较快的目的。</p>
<p>结构化检索：我想搜索商品分类为日化用品的商品都有哪些，select * from<br>products where category_id=’日化用品’。</p>
<p>数据分析：电商网站，最近7天牙膏这种商品销量排名前10的商家有哪些；新闻网站，最近1个月访问量排名前3的新闻版块是哪些。</p>
<h2 id="Elasticsearch的适用场景"><a href="#Elasticsearch的适用场景" class="headerlink" title="Elasticsearch的适用场景"></a>Elasticsearch的适用场景</h2><p>1）维基百科，类似百度百科，牙膏，牙膏的维基百科，全文检索，高亮，搜索推荐。</p>
<p>2）The Guardian（国外新闻网站），类似搜狐新闻，用户行为日志（点击，浏览，收藏，评论）+<br>社交网络数据（对某某新闻的相关看法），数据分析，给到每篇新闻文章的作者，让他知道他的文章的公众反馈（好，坏，热门，垃圾，鄙视，崇拜）。</p>
<p>3）Stack Overflow（国外的程序异常讨论论坛），IT问题，程序的报错，提交上去，有人会跟你讨论和回答，全文检索，搜索相关问题和答案，程序报错了，就会将报错信息粘贴到里面去，搜索有没有对应的答案。</p>
<p>4）GitHub（开源代码管理），搜索上千亿行代码。</p>
<p>5）国内：站内搜索（电商，招聘，门户，等等），IT系统搜索（OA，CRM，ERP，等等），数据分析（ES热门的一个使用场景）。</p>
<h2 id="Elasticsearch的特点"><a href="#Elasticsearch的特点" class="headerlink" title="Elasticsearch的特点"></a>Elasticsearch的特点</h2><p>1）可以作为一个大型分布式集群（数百台服务器）技术，处理PB级数据，服务大公司；也可以运行在单机上，服务小公司</p>
<p>2）Elasticsearch不是什么新技术，主要是将全文检索、数据分析以及分布式技术，合并在了一起，才形成了独一无二的ES；lucene（全文检索），商用的数据分析软件（也是有的），分布式数据库（mycat）</p>
<p>3）对用户而言，是开箱即用的，非常简单，作为中小型的应用，直接3分钟部署一下ES，就可以作为生产环境的系统来使用了，数据量不大，操作不是太复杂</p>
<p>4）数据库的功能面对很多领域是不够用的（事务，还有各种联机事务型的操作）；特殊的功能，比如全文检索，同义词处理，相关度排名，复杂数据分析，海量数据的近实时处理；Elasticsearch作为传统数据库的一个补充，提供了数据库所不能提供的很多功能</p>
<h2 id="Elasticsearch的核心概念"><a href="#Elasticsearch的核心概念" class="headerlink" title="Elasticsearch的核心概念"></a>Elasticsearch的核心概念</h2><h3 id="近实时"><a href="#近实时" class="headerlink" title="近实时"></a>近实时</h3><p>近实时，两个意思，从写入数据到数据可以被搜索到有一个小延迟（大概1秒）；基于es执行搜索和分析可以达到秒级。</p>
<h3 id="Cluster（集群）"><a href="#Cluster（集群）" class="headerlink" title="Cluster（集群）"></a>Cluster（集群）</h3><p>集群包含多个节点，每个节点属于哪个集群是通过一个配置（集群名称，默认是elasticsearch）来决定的，对于中小型应用来说，刚开始一个集群就一个节点很正常</p>
<h3 id="Node（节点）"><a href="#Node（节点）" class="headerlink" title="Node（节点）"></a>Node（节点）</h3><p>集群中的一个节点，节点也有一个名称（默认是随机分配的），节点名称很重要（在执行运维管理操作的时候），默认节点会去加入一个名称为”elasticsearch”的集群，如果直接启动一堆节点，那么它们会自动组成一个elasticsearch集群，当然一个节点也可以组成一个elasticsearch集群。</p>
<h3 id="Index（索引-数据库）"><a href="#Index（索引-数据库）" class="headerlink" title="Index（索引-数据库）"></a>Index（索引-数据库）</h3><p>索引包含一堆有相似结构的文档数据，比如可以有一个客户索引，商品分类索引，订单索引，索引有一个名称。一个index包含很多document，一个index就代表了一类类似的或者相同的document。比如说建立一个product index，商品索引，里面可能就存放了所有的商品数据，所有的商品document。</p>
<h3 id="Type（类型-表）"><a href="#Type（类型-表）" class="headerlink" title="Type（类型-表）"></a>Type（类型-表）</h3><p>6.0版本之前每个索引里都可以有多个type；</p>
<p>6.0版本之后每个索引里面只能有一个Type，一般使用_doc代替了。</p>
<p>7.0版本之后没有Type概念。</p>
<p>商品index，里面存放了所有的商品数据，商品document</p>
<p>商品type：product_id，product_name，product_desc，category_id，category_name，service_period</p>
<p>每一个type里面，都会包含一堆document</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="string">"product_id"</span>: <span class="string">"1"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"product_name"</span>: <span class="string">"长虹电视机"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"product_desc"</span>: <span class="string">"4k高清"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"category_id"</span>: <span class="string">"3"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"category_name"</span>: <span class="string">"电器"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"service_period"</span>: <span class="string">"1年"</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="string">"product_id"</span>: <span class="string">"2"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"product_name"</span>: <span class="string">"基围虾"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"product_desc"</span>: <span class="string">"纯天然，冰岛产"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"category_id"</span>: <span class="string">"4"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"category_name"</span>: <span class="string">"生鲜"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"eat_period"</span>: <span class="string">"7天"</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Document（文档-行）"><a href="#Document（文档-行）" class="headerlink" title="Document（文档-行）"></a>Document（文档-行）</h3><p>文档是ES中的最小数据单元，一个document可以是一条客户数据，一条商品分类数据，一条订单数据，通常用JSON数据结构表示，每个index下的type中，都可以去存储多个document。</p>
<h3 id="Field（字段-列）"><a href="#Field（字段-列）" class="headerlink" title="Field（字段-列）"></a>Field（字段-列）</h3><p>Field是Elasticsearch的最小单位。一个document里面有多个field，每个field就是一个数据字段。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">product document</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="string">"product_id"</span>: <span class="string">"1"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"product_name"</span>: <span class="string">"高露洁牙膏"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"product_desc"</span>: <span class="string">"高效美白"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"category_id"</span>: <span class="string">"2"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"category_name"</span>: <span class="string">"日化用品"</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Mapping（映射-约束）"><a href="#Mapping（映射-约束）" class="headerlink" title="Mapping（映射-约束）"></a>Mapping（映射-约束）</h3><p>数据如何存放到索引对象上，需要有一个映射配置，包括：数据类型、是否存储、是否分词等。</p>
<p>Mapping用来定义Document中每个字段的类型，即所使用的分词器、是否索引等属性，非常关键等。创建Mapping<br>的代码示例如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">PUT student**(index_name-&gt;database)**</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="string">"mappings"</span>: &#123;</span><br><span class="line"></span><br><span class="line"><span class="string">"_doc"</span>:&#123;**(type_name-&gt;table)**</span><br><span class="line"></span><br><span class="line"><span class="string">"properties"</span>:&#123;</span><br><span class="line"></span><br><span class="line"><span class="string">"stu_id"</span>:&#123;**(field_name-&gt;colume)**</span><br><span class="line"></span><br><span class="line"><span class="string">"type"</span>:<span class="string">"keyword"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"store"</span>:<span class="string">"true"</span></span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="string">"name"</span>:&#123;**(field_name-&gt;colume)**</span><br><span class="line"></span><br><span class="line"><span class="string">"type"</span>:<span class="string">"keyword"</span></span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="string">"birth"</span>:&#123;**(field_name-&gt;colume)**</span><br><span class="line"></span><br><span class="line"><span class="string">"type"</span>:<span class="string">"date"</span>(yyyy-MM-dd HH:mm)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ElasticSearch与数据库的类比"><a href="#ElasticSearch与数据库的类比" class="headerlink" title="ElasticSearch与数据库的类比"></a>ElasticSearch与数据库的类比</h3><table>
<thead>
<tr>
<th>关系型数据库（比如Mysql)</th>
<th>非关系型数据库（Elasticsearch）</th>
</tr>
</thead>
<tbody><tr>
<td>数据库Database</td>
<td>索引Index</td>
</tr>
<tr>
<td>表Table</td>
<td>类型Type(6.0版本之后在一个索引下面只能有一个，7.0版本之后取消了Type)</td>
</tr>
<tr>
<td>数据行Row</td>
<td>文档Document(JSON格式)</td>
</tr>
<tr>
<td>数据列Column</td>
<td>字段Field</td>
</tr>
<tr>
<td>约束 Schema</td>
<td>映射Mapping</td>
</tr>
</tbody></table>
<hr>
<h3 id="ElasticSearch存入数据和搜索数据机制"><a href="#ElasticSearch存入数据和搜索数据机制" class="headerlink" title="ElasticSearch存入数据和搜索数据机制"></a>ElasticSearch存入数据和搜索数据机制</h3><p><img src="/bigdata/ElasticSearch%E4%BB%8B%E7%BB%8D/3.png" alt="3"></p>
<p>1）索引对象（blog）：存储数据的表结构 ，任何搜索数据，存放在索引对象上。</p>
<p>2）映射（mapping）：数据如何存放到索引对象上，需要有一个映射配置，<br>包括：数据类型、是否存储、是否分词等。</p>
<p>3）文档（document）：一条数据记录，存在索引对象上。</p>
<p>4）文档类型（type）：一个索引对象，存放多种类型数据，数据用文档类型进行标识。</p>
<h1 id="Elasticsearch快速入门"><a href="#Elasticsearch快速入门" class="headerlink" title="Elasticsearch快速入门"></a>Elasticsearch快速入门</h1><h2 id="安装包下载"><a href="#安装包下载" class="headerlink" title="安装包下载"></a>安装包下载</h2><p>1）ElasticSearch官网：<br><a href="https://www.elastic.co/cn/downloads/elasticsearch" target="_blank" rel="noopener">https://www.elastic.co/cn/downloads/elasticsearch</a></p>
<p><img src="/bigdata/ElasticSearch%E4%BB%8B%E7%BB%8D/%E5%9B%BE%E7%89%871.png" alt="图片1"></p>
<h2 id="Elasticsearch安装"><a href="#Elasticsearch安装" class="headerlink" title="Elasticsearch安装"></a>Elasticsearch安装</h2><p>1）解压elasticsearch-6.6.0.tar.gz到/opt/module目录下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[red@hadoop102 software]$ tar -zxvf elasticsearch-6.6.0.tar.gz -C &#x2F;opt&#x2F;module&#x2F;</span><br></pre></td></tr></table></figure>

<p>2）在/opt/module/elasticsearch-6.6.0路径下创建data文件夹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[red@hadoop102 elasticsearch-6.6.0]$ mkdir data</span><br></pre></td></tr></table></figure>

<p>3）修改配置文件/opt/module/elasticsearch-6.6.0/config/elasticsearch.yml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[red@hadoop102 config]$ pwd</span><br><span class="line"></span><br><span class="line">&#x2F;opt&#x2F;module&#x2F;elasticsearch-6.6.0&#x2F;config</span><br><span class="line"></span><br><span class="line">[red@hadoop102 config]$ vi elasticsearch.yml</span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-----------------------Cluster-----------------------</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cluster.name:</span> <span class="string">my-application</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------Node-----------------------</span></span><br><span class="line"></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">node-102</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------Paths-----------------------</span></span><br><span class="line"></span><br><span class="line"><span class="attr">path.data:</span> <span class="string">/opt/module/elasticsearch-6.6.0/data</span></span><br><span class="line"></span><br><span class="line"><span class="attr">path.logs:</span> <span class="string">/opt/module/elasticsearch-6.6.0/logs</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------Memory-----------------------</span></span><br><span class="line"></span><br><span class="line"><span class="attr">bootstrap.memory_lock:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">bootstrap.system_call_filter:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------Network-----------------------</span></span><br><span class="line"></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">192.168</span><span class="number">.9</span><span class="number">.102</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------Discovery-----------------------</span></span><br><span class="line"></span><br><span class="line"><span class="attr">discovery.zen.ping.unicast.hosts:</span> <span class="string">["192.168.9.102"]</span></span><br></pre></td></tr></table></figure>

<p>（1）cluster.name 如果要配置集群需要两个节点上的elasticsearch配置的cluster.name相同，都启动可以自动组成集群，这里如果不改cluster.name则默认是<code>cluster.name=my-application</code></p>
<p>（2）nodename随意取但是集群内的各节点不能相同</p>
<p>（3）修改后的每行前面不能有空格，修改后的”：”后面必须有一个空格</p>
<p>分发至hadoop103以及hadoop104，分发之后修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[red@hadoop102 module]$ xsync elasticsearch-6.6.0&#x2F;</span><br><span class="line"></span><br><span class="line">node.name: node-103</span><br><span class="line"></span><br><span class="line">network.host: 192.168.9.103</span><br><span class="line"></span><br><span class="line">node.name: node-104</span><br><span class="line"></span><br><span class="line">network.host: 192.168.9.104</span><br></pre></td></tr></table></figure>

<p>5）配置linux系统环境（参考：<a href="http://blog.csdn.net/satiling/article/details/59697916" target="_blank" rel="noopener">http://blog.csdn.net/satiling/article/details/59697916</a>）</p>
<p><strong>问题1：max file descriptors [4096] for elasticsearch process likely<br>too low, increase to at least [65536] elasticsearch</strong></p>
<p>（1）切换到root用户，编辑limits.conf 添加类似如下内容</p>
<p>[root@hadoop102s elasticsearch-6.6.0]# vi /etc/security/limits.conf</p>
<p>添加如下内容:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* soft nofile 65536</span><br><span class="line"></span><br><span class="line">* hard nofile 131072</span><br><span class="line"></span><br><span class="line">* soft nproc 2048</span><br><span class="line"></span><br><span class="line">* hard nproc 4096</span><br></pre></td></tr></table></figure>

<p><strong>问题2：max number of threads [1024] for user [judy2] likely too<br>low, increase to at least [4096]</strong> （CentOS7.x 不用改）</p>
<p>（2）切换到root用户，进入limits.d目录下修改配置文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop102 elasticsearch-6.6.0]# vi</span><br><span class="line">&#x2F;etc&#x2F;security&#x2F;limits.d&#x2F;90-nproc.conf</span><br><span class="line"></span><br><span class="line">修改如下内容：</span><br><span class="line"></span><br><span class="line">* soft nproc 1024</span><br><span class="line"></span><br><span class="line">#修改为</span><br><span class="line"></span><br><span class="line">* soft nproc 4096</span><br></pre></td></tr></table></figure>

<p><strong>问题3：max virtual memory areas vm.max_map_count [65530] likely too<br>low, increase to at least [262144]</strong> （CentOS7.x 不用改）</p>
<p>（3）切换到root用户修改配置sysctl.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop102 elasticsearch-6.6.0]# vi &#x2F;etc&#x2F;sysctl.conf</span><br></pre></td></tr></table></figure>

<p>添加下面配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.max_map_count&#x3D;655360</span><br></pre></td></tr></table></figure>

<p>并执行命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop102 elasticsearch-6.6.0]# sysctl -p</span><br></pre></td></tr></table></figure>

<p>以上修改的Linux配置需要分发至其他节点。</p>
<p>然后，重新启动Linux，必须重启！！！</p>
<p>6）启动Elasticsearch</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[red@hadoop102 elasticsearch-6.6.0]$ bin&#x2F;elasticsearch</span><br></pre></td></tr></table></figure>

<p>7）测试elasticsearch</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[red@hadoop102 elasticsearch-6.6.0]$ curl http:&#x2F;&#x2F;hadoop102:9200</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;name&quot; : &quot;node-102&quot;,</span><br><span class="line"></span><br><span class="line">&quot;cluster_name&quot; : &quot;my-application&quot;,</span><br><span class="line"></span><br><span class="line">&quot;cluster_uuid&quot; : &quot;KOpuhMgVRzW_9OTjMsHf2Q&quot;,</span><br><span class="line"></span><br><span class="line">&quot;version&quot; : &#123;</span><br><span class="line"></span><br><span class="line">&quot;number&quot; : &quot;6.6.0&quot;,</span><br><span class="line"></span><br><span class="line">&quot;build_flavor&quot; : &quot;default&quot;,</span><br><span class="line"></span><br><span class="line">&quot;build_type&quot; : &quot;tar&quot;,</span><br><span class="line"></span><br><span class="line">&quot;build_hash&quot; : &quot;eb782d0&quot;,</span><br><span class="line"></span><br><span class="line">&quot;build_date&quot; : &quot;2018-06-29T21:59:26.107521Z&quot;,</span><br><span class="line"></span><br><span class="line">&quot;build_snapshot&quot; : false,</span><br><span class="line"></span><br><span class="line">&quot;lucene_version&quot; : &quot;7.3.1&quot;,</span><br><span class="line"></span><br><span class="line">&quot;minimum_wire_compatibility_version&quot; : &quot;5.6.0&quot;,</span><br><span class="line"></span><br><span class="line">&quot;minimum_index_compatibility_version&quot; : &quot;5.0.0&quot;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>8）停止集群</p>
<p><code>kill -9 进程号</code></p>
<p>9）群起脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[red@hadoop102 bin]$ vi es.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">es_home=/opt/module/elasticsearch</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line"><span class="string">"start"</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> hadoop102 hadoop103 hadoop104</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"==============<span class="variable">$i</span>=============="</span></span><br><span class="line"></span><br><span class="line">ssh <span class="variable">$i</span> <span class="string">"source /etc/profile;<span class="variable">$&#123;es_home&#125;</span>/bin/elasticsearch &gt;/dev/null</span></span><br><span class="line"><span class="string">2&gt;&amp;1 &amp;"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">&#125;;;</span><br><span class="line"></span><br><span class="line"><span class="string">"stop"</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> hadoop102 hadoop103 hadoop104</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"==============<span class="variable">$i</span>=============="</span></span><br><span class="line"></span><br><span class="line">ssh <span class="variable">$i</span> <span class="string">"ps -ef|grep <span class="variable">$es_home</span> |grep -v grep|awk '&#123;print</span></span><br><span class="line"><span class="string"><span class="variable">$2</span>&#125;'|xargs kill"</span> &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">&#125;;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<h2 id="Elasticsearch操作工具"><a href="#Elasticsearch操作工具" class="headerlink" title="Elasticsearch操作工具"></a>Elasticsearch操作工具</h2><h3 id="浏览器"><a href="#浏览器" class="headerlink" title="浏览器"></a>浏览器</h3><p><img src="/bigdata/ElasticSearch%E4%BB%8B%E7%BB%8D/%E5%9B%BE%E7%89%872.png" alt="图片2"></p>
<h3 id="Linux命令行"><a href="#Linux命令行" class="headerlink" title="Linux命令行"></a>Linux命令行</h3><p>请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@linux1 es] curl -XPOST &#39;http:&#x2F;&#x2F;192.168.9.102:9200&#x2F;red&#x2F;_doc&#39; -i -H</span><br><span class="line">&quot;Content-Type:application&#x2F;json&quot; -d &#39;&#123;&quot;name&quot;:&quot;haha&quot;,&quot;age&quot;:&quot;10&quot;&#125;&#39;</span><br></pre></td></tr></table></figure>

<p>响应：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 201 Created</span><br><span class="line"></span><br><span class="line">Location: &#x2F;atguig&#x2F;doc&#x2F;Hm7z1GwBEd-elda4prGr</span><br><span class="line"></span><br><span class="line">content-type: application&#x2F;json; charset&#x3D;UTF-8</span><br><span class="line"></span><br><span class="line">content-length: 172</span><br><span class="line"></span><br><span class="line">&#123;&quot;_index&quot;:&quot;red&quot;,&quot;_type&quot;:&quot;_doc&quot;,&quot;_id&quot;:&quot;Hm7z1GwBEd-elda4prGr&quot;,&quot;_version&quot;:1,&quot;result&quot;:&quot;created&quot;,&quot;_shards&quot;:&#123;&quot;total&quot;:2,&quot;successful&quot;:1,&quot;failed&quot;:0&#125;,&quot;_seq_no&quot;:0,&quot;_primary_term&quot;:1&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Kibana的Dev-Tools"><a href="#Kibana的Dev-Tools" class="headerlink" title="Kibana的Dev Tools"></a>Kibana的Dev Tools</h3><p><img src="/bigdata/ElasticSearch%E4%BB%8B%E7%BB%8D/%E5%9B%BE%E7%89%873.png" alt="图片3"></p>
<h1 id="Elasticsearch使用"><a href="#Elasticsearch使用" class="headerlink" title="Elasticsearch使用"></a>Elasticsearch使用</h1><h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><h3 id="核心数据类型"><a href="#核心数据类型" class="headerlink" title="核心数据类型"></a>核心数据类型</h3><p>字符串型：text(分词)、keyword(不分词)</p>
<p>数值型：long、integer、short、byte、double、float、half_float、scaled_float</p>
<p>日期类型：date</p>
<p>布尔类型：boolean</p>
<p>二进制类型：binary</p>
<p>范围类型：integer_range、float_range、long_range、double_range、date_range</p>
<h3 id="复杂数据类型"><a href="#复杂数据类型" class="headerlink" title="复杂数据类型"></a>复杂数据类型</h3><p>数组类型：array</p>
<p>对象类型：object</p>
<p>嵌套类型：nested object</p>
<h3 id="地理位置数据类型"><a href="#地理位置数据类型" class="headerlink" title="地理位置数据类型"></a>地理位置数据类型</h3><p>geo_point(点)、geo_shape(形状)</p>
<h3 id="专用类型"><a href="#专用类型" class="headerlink" title="专用类型"></a>专用类型</h3><p>记录IP地址ip</p>
<p>实现自动补全completion</p>
<p>记录分词数：token_count</p>
<p>记录字符串hash值murmur3</p>
<p>多字段特性multi-fields</p>
<h2 id="Mapping"><a href="#Mapping" class="headerlink" title="Mapping"></a>Mapping</h2><h3 id="手动创建"><a href="#手动创建" class="headerlink" title="手动创建"></a>手动创建</h3><p>1）创建操作</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">PUT my_index1</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">"mappings": &#123;</span><br><span class="line"></span><br><span class="line">"_doc":&#123;</span><br><span class="line"></span><br><span class="line">"properties":&#123;</span><br><span class="line"></span><br><span class="line">"username":&#123;</span><br><span class="line"></span><br><span class="line">"type": "text",</span><br><span class="line"></span><br><span class="line">"fields": &#123;</span><br><span class="line"></span><br><span class="line">"pinyin":&#123;</span><br><span class="line"></span><br><span class="line">"type": "text"</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2）创建文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT my_index1&#x2F;_doc&#x2F;1&#96;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;username&quot;:&quot;haha heihei&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3）查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET my_index1&#x2F;_search</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;query&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;match&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;username.pinyin&quot;: &quot;haha&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="自动创建"><a href="#自动创建" class="headerlink" title="自动创建"></a>自动创建</h3><p>ES可以自动识别文档字段类型，从而降低用户使用成本</p>
<p>1）直接插入文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;test_index&#x2F;_doc&#x2F;1</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;username&quot;:&quot;alfred&quot;,</span><br><span class="line"></span><br><span class="line">&quot;age&quot;:1,</span><br><span class="line"></span><br><span class="line">&quot;birth&quot;:&quot;1991-12-15&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2）查看mapping</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;test_index&#x2F;doc&#x2F;_mapping</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;test_index&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;mappings&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;doc&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;properties&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;age&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;type&quot;: &quot;long&quot;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&quot;birth&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;type&quot;: &quot;date&quot;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&quot;username&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;type&quot;: &quot;text&quot;,</span><br><span class="line"></span><br><span class="line">&quot;fields&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;keyword&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line"></span><br><span class="line">&quot;ignore_above&quot;: 256</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>age自动识别为long类型，username识别为text类型</p>
<p>3）日期类型的自动识别</p>
<p>日期的自动识别可以自行配置日期格式，以满足各种需求。</p>
<p>（1）自定义日期识别格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PUT my_index</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;mappings&quot;:&#123;</span><br><span class="line"></span><br><span class="line">&quot;_doc&quot;:&#123;</span><br><span class="line"></span><br><span class="line">&quot;dynamic_date_formats&quot;: [&quot;yyyy-MM-dd&quot;,&quot;yyyy&#x2F;MM&#x2F;dd&quot;]</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）关闭日期自动识别</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PUT my_index</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;mappings&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;_doc&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;date_detection&quot;: false</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4）字符串是数字时，默认不会自动识别为整形，因为字符串中出现数字时完全合理的</p>
<p>Numeric_datection可以开启字符串中数字的自动识别</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PUT my_index</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;mappings&quot;:&#123;</span><br><span class="line"></span><br><span class="line">&quot;doc&quot;:&#123;</span><br><span class="line"></span><br><span class="line">&quot;numeric_datection&quot;: true</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="IK分词器"><a href="#IK分词器" class="headerlink" title="IK分词器"></a>IK分词器</h2><h3 id="为什么使用分词器"><a href="#为什么使用分词器" class="headerlink" title="为什么使用分词器"></a>为什么使用分词器</h3><p>分词器主要应用在中文上，在ES中字符串类型有keyword和text两种。keyword默认不进行分词，而text是将每一个汉字拆开称为独立的词，这两种都是不适用于生产环境，所以我们需要有其他的分词器帮助我们完成这些事情，其中IK分词器是应用最为广泛的一个分词器。</p>
<p>1）keyword类型的分词</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;keyword&quot;:&quot;我是程序员&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果展示（报错）</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;error&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;root_cause&quot;: [</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;type&quot;: &quot;illegal_argument_exception&quot;,</span><br><span class="line"></span><br><span class="line">&quot;reason&quot;: &quot;Unknown parameter [keyword] in request body or parameter</span><br><span class="line">is of the wrong type[VALUE_STRING] &quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">&quot;type&quot;: &quot;illegal_argument_exception&quot;,</span><br><span class="line"></span><br><span class="line">&quot;reason&quot;: &quot;Unknown parameter [keyword] in request body or parameter</span><br><span class="line">is of the wrong type[VALUE_STRING] &quot;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&quot;status&quot;: 400</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2）text类型的分词</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;text&quot;:&quot;我是程序员&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果展示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;tokens&quot;: [</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;token&quot;: &quot;我&quot;,</span><br><span class="line"></span><br><span class="line">&quot;start_offset&quot;: 0,</span><br><span class="line"></span><br><span class="line">&quot;end_offset&quot;: 1,</span><br><span class="line"></span><br><span class="line">&quot;type&quot;: &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line"></span><br><span class="line">&quot;position&quot;: 0</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;token&quot;: &quot;是&quot;,</span><br><span class="line"></span><br><span class="line">&quot;start_offset&quot;: 1,</span><br><span class="line"></span><br><span class="line">&quot;end_offset&quot;: 2,</span><br><span class="line"></span><br><span class="line">&quot;type&quot;: &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line"></span><br><span class="line">&quot;position&quot;: 1</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;token&quot;: &quot;程&quot;,</span><br><span class="line"></span><br><span class="line">&quot;start_offset&quot;: 2,</span><br><span class="line"></span><br><span class="line">&quot;end_offset&quot;: 3,</span><br><span class="line"></span><br><span class="line">&quot;type&quot;: &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line"></span><br><span class="line">&quot;position&quot;: 2</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;token&quot;: &quot;序&quot;,</span><br><span class="line"></span><br><span class="line">&quot;start_offset&quot;: 3,</span><br><span class="line"></span><br><span class="line">&quot;end_offset&quot;: 4,</span><br><span class="line"></span><br><span class="line">&quot;type&quot;: &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line"></span><br><span class="line">&quot;position&quot;: 3</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;token&quot;: &quot;员&quot;,</span><br><span class="line"></span><br><span class="line">&quot;start_offset&quot;: 4,</span><br><span class="line"></span><br><span class="line">&quot;end_offset&quot;: 5,</span><br><span class="line"></span><br><span class="line">&quot;type&quot;: &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line"></span><br><span class="line">&quot;position&quot;: 4</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="IK分词器安装"><a href="#IK分词器安装" class="headerlink" title="IK分词器安装"></a>IK分词器安装</h3><p>1）下载与安装的ES相对应的版本</p>
<p>2）解压elasticsearch-analysis-ik-6.6.0.zip，将解压后的IK文件夹拷贝到ES安装目录下的plugins目录下，并重命名文件夹为ik（什么名称都OK）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[red@hadoop102 plugins]$ mkdir ik</span><br><span class="line"></span><br><span class="line">[red@hadoop102 software]$ unzip elasticsearch-analysis-ik-6.6.0.zip -d</span><br><span class="line">&#x2F;opt&#x2F;module&#x2F;elasticsearch-6.6.0&#x2F;plugins&#x2F;ik&#x2F;</span><br></pre></td></tr></table></figure>

<p>3）分发分词器目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[red@hadoop102 elasticsearch-6.6.0]$ xsync plugins&#x2F;</span><br></pre></td></tr></table></figure>

<p>4）重新启动Elasticsearch，即可加载IK分词器</p>
<h3 id="IK分词器测试"><a href="#IK分词器测试" class="headerlink" title="IK分词器测试"></a>IK分词器测试</h3><p>IK提供了两个分词算法ik_smart 和 ik_max_word，其中 ik_smart为最少切分，ik_max_word为最细粒度划分。</p>
<p>1）最少划分ik_smart</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">get _analyze</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;analyzer&quot;: &quot;ik_smart&quot;,</span><br><span class="line"></span><br><span class="line">&quot;text&quot;:&quot;我是程序员&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果展示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;tokens&quot; : [</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;token&quot; : &quot;我&quot;,</span><br><span class="line"></span><br><span class="line">&quot;start_offset&quot; : 0,</span><br><span class="line"></span><br><span class="line">&quot;end_offset&quot; : 1,</span><br><span class="line"></span><br><span class="line">&quot;type&quot; : &quot;CN_CHAR&quot;,</span><br><span class="line"></span><br><span class="line">&quot;position&quot; : 0</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;token&quot; : &quot;是&quot;,</span><br><span class="line"></span><br><span class="line">&quot;start_offset&quot; : 1,</span><br><span class="line"></span><br><span class="line">&quot;end_offset&quot; : 2,</span><br><span class="line"></span><br><span class="line">&quot;type&quot; : &quot;CN_CHAR&quot;,</span><br><span class="line"></span><br><span class="line">&quot;position&quot; : 1</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;token&quot; : &quot;程序员&quot;,</span><br><span class="line"></span><br><span class="line">&quot;start_offset&quot; : 2,</span><br><span class="line"></span><br><span class="line">&quot;end_offset&quot; : 5,</span><br><span class="line"></span><br><span class="line">&quot;type&quot; : &quot;CN_WORD&quot;,</span><br><span class="line"></span><br><span class="line">&quot;position&quot; : 2</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2）最细切分ik_max_word</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">get _analyze</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line"></span><br><span class="line">&quot;text&quot;:&quot;我是程序员&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;tokens&quot; : [</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;token&quot; : &quot;我&quot;,</span><br><span class="line"></span><br><span class="line">&quot;start_offset&quot; : 0,</span><br><span class="line"></span><br><span class="line">&quot;end_offset&quot; : 1,</span><br><span class="line"></span><br><span class="line">&quot;type&quot; : &quot;CN_CHAR&quot;,</span><br><span class="line"></span><br><span class="line">&quot;position&quot; : 0</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;token&quot; : &quot;是&quot;,</span><br><span class="line"></span><br><span class="line">&quot;start_offset&quot; : 1,</span><br><span class="line"></span><br><span class="line">&quot;end_offset&quot; : 2,</span><br><span class="line"></span><br><span class="line">&quot;type&quot; : &quot;CN_CHAR&quot;,</span><br><span class="line"></span><br><span class="line">&quot;position&quot; : 1</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;token&quot; : &quot;程序员&quot;,</span><br><span class="line"></span><br><span class="line">&quot;start_offset&quot; : 2,</span><br><span class="line"></span><br><span class="line">&quot;end_offset&quot; : 5,</span><br><span class="line"></span><br><span class="line">&quot;type&quot; : &quot;CN_WORD&quot;,</span><br><span class="line"></span><br><span class="line">&quot;position&quot; : 2</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;token&quot; : &quot;程序&quot;,</span><br><span class="line"></span><br><span class="line">&quot;start_offset&quot; : 2,</span><br><span class="line"></span><br><span class="line">&quot;end_offset&quot; : 4,</span><br><span class="line"></span><br><span class="line">&quot;type&quot; : &quot;CN_WORD&quot;,</span><br><span class="line"></span><br><span class="line">&quot;position&quot; : 3</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;token&quot; : &quot;员&quot;,</span><br><span class="line"></span><br><span class="line">&quot;start_offset&quot; : 4,</span><br><span class="line"></span><br><span class="line">&quot;end_offset&quot; : 5,</span><br><span class="line"></span><br><span class="line">&quot;type&quot; : &quot;CN_CHAR&quot;,</span><br><span class="line"></span><br><span class="line">&quot;position&quot; : 4</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="检索文档"><a href="#检索文档" class="headerlink" title="检索文档"></a>检索文档</h2><p>向Elasticsearch增加数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;red&#x2F;doc&#x2F;1</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;first_name&quot; : &quot;John&quot;,</span><br><span class="line"></span><br><span class="line">&quot;last_name&quot; : &quot;Smith&quot;,</span><br><span class="line"></span><br><span class="line">&quot;age&quot; : 25,</span><br><span class="line"></span><br><span class="line">&quot;about&quot; : &quot;I love to go rock climbing&quot;,</span><br><span class="line"></span><br><span class="line">&quot;interests&quot;: [&quot;sports&quot;, &quot;music&quot;]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果在关系型数据库Mysql中主键查询数据一般会执行下面的SQL语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from red where id &#x3D; 1;</span><br></pre></td></tr></table></figure>

<p>但在Elasticsearch中需要采用特殊的方式 ： # 协议方法 索引/类型/文档编号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;red&#x2F;doc&#x2F;1</span><br><span class="line"></span><br><span class="line">响应</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;_index&quot;: &quot;red&quot;,</span><br><span class="line"></span><br><span class="line">&quot;_type&quot;: &quot;doc&quot;,</span><br><span class="line"></span><br><span class="line">&quot;_id&quot;: &quot;1&quot;,</span><br><span class="line"></span><br><span class="line">&quot;_version&quot;: 1,</span><br><span class="line"></span><br><span class="line">&quot;found&quot;: true,</span><br><span class="line"></span><br><span class="line">&quot;_source&quot;: &#123; &#x2F;&#x2F; 文档的原始数据JSON数据</span><br><span class="line"></span><br><span class="line">&quot;first_name&quot;: &quot;John&quot;,</span><br><span class="line"></span><br><span class="line">&quot;last_name&quot;: &quot;Smith&quot;,</span><br><span class="line"></span><br><span class="line">&quot;age&quot;: 25,</span><br><span class="line"></span><br><span class="line">&quot;about&quot;: &quot;I love to go rock climbing&quot;,</span><br><span class="line"></span><br><span class="line">&quot;interests&quot;: [</span><br><span class="line"></span><br><span class="line">&quot;sports&quot;,</span><br><span class="line"></span><br><span class="line">&quot;music&quot;</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们通过HTTP方法GET来检索文档，同样的，我们可以使用DELETE方法删除文档，使用HEAD方法检查某文档是否存在。如果想更新已存在的文档，我们只需再PUT一次。</p>
<h3 id="元数据查询"><a href="#元数据查询" class="headerlink" title="元数据查询"></a>元数据查询</h3><p>GET _cat/indices</p>
<table>
<thead>
<tr>
<th>health</th>
<th>green(集群完整) yellow(单点正常、集群不完整) red(单点不正常)</th>
</tr>
</thead>
<tbody><tr>
<td>status</td>
<td>是否能使用</td>
</tr>
<tr>
<td>index</td>
<td>索引名</td>
</tr>
<tr>
<td>uuid</td>
<td>索引统一编号</td>
</tr>
<tr>
<td>pri</td>
<td>主节点几个</td>
</tr>
<tr>
<td>rep</td>
<td>从节点几个</td>
</tr>
<tr>
<td>docs.count</td>
<td>文档数</td>
</tr>
<tr>
<td>docs.deleted</td>
<td>文档被删了多少</td>
</tr>
<tr>
<td>store.size</td>
<td>整体占空间大小</td>
</tr>
<tr>
<td>pri.store.size</td>
<td>主节点占</td>
</tr>
</tbody></table>
<hr>
<h3 id="全文档检索"><a href="#全文档检索" class="headerlink" title="全文档检索"></a>全文档检索</h3><p>如果在关系型数据库Mysql中查询所有数据一般会执行下面的SQL语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user;</span><br></pre></td></tr></table></figure>

<p>但在Elasticsearch中需要采用特殊的方式</p>
<h1 id="协议方法-索引-类型-search"><a href="#协议方法-索引-类型-search" class="headerlink" title="协议方法 索引/类型/_search"></a>协议方法 索引/类型/_search</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;red&#x2F;_doc&#x2F;**_search**</span><br></pre></td></tr></table></figure>

<p>响应内容不仅会告诉我们哪些文档被匹配到，而且这些文档内容完整的被包含在其中—我们在给用户展示搜索结果时需要用到的所有信息都有了。</p>
<h3 id="字段全值匹配检索"><a href="#字段全值匹配检索" class="headerlink" title="字段全值匹配检索"></a>字段全值匹配检索</h3><p>如果在关系型数据库Mysql中查询多字段匹配数据（字段检索）</p>
<p>一般会执行下面的SQL语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from red where name &#x3D; &#39;haha&#39;;</span><br></pre></td></tr></table></figure>

<p>但在Elasticsearch中需要采用特殊的方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">GET red&#x2F;_search</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;query&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;bool&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;filter&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;term&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;about&quot;: &quot;I love to go rock climbing&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="字段分词匹配检索"><a href="#字段分词匹配检索" class="headerlink" title="字段分词匹配检索"></a>字段分词匹配检索</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET red&#x2F;_search</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;query&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;match&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;about&quot;: &quot;I&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="字段模糊匹配检索"><a href="#字段模糊匹配检索" class="headerlink" title="字段模糊匹配检索"></a>字段模糊匹配检索</h3><p>如果在关系型数据库Mysql中模糊查询多字段数据</p>
<p>一般会执行下面的SQL语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where name like &#39;%haha%&#39;</span><br></pre></td></tr></table></figure>

<p>但在Elasticsearch中需要采用特殊的方式，查询出所有文档字段值分词后包含haha的文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET test&#x2F;_search</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;query&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;fuzzy&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;aa&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;value&quot;: &quot;我是程序&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="聚合检索"><a href="#聚合检索" class="headerlink" title="聚合检索"></a>聚合检索</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET test&#x2F;_search</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;aggs&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;groupby_aa&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;terms&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;field&quot;: &quot;aa&quot;,</span><br><span class="line"></span><br><span class="line">&quot;size&quot;: 10</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="分页检索"><a href="#分页检索" class="headerlink" title="分页检索"></a>分页检索</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET movie_index&#x2F;movie&#x2F;_search</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;,</span><br><span class="line"></span><br><span class="line">&quot;from&quot;: 1,</span><br><span class="line"></span><br><span class="line">&quot;size&quot;: 1</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="索引别名-aliases"><a href="#索引别名-aliases" class="headerlink" title="索引别名 _aliases"></a>索引别名 _aliases</h2><p>索引<em>别名</em>就像一个快捷方式或软连接，可以指向一个或多个索引，也可以给任何一个需要索引名的API来使用。别名带给我们极大的灵活性，允许我们做下面这些：</p>
<p>1）给多个索引分组 (例如， last_three_months)</p>
<p>2）给索引的一个子集创建视图</p>
<p>3）在运行的集群中可以无缝的从一个索引切换到另一个索引</p>
<h3 id="创建索引别名"><a href="#创建索引别名" class="headerlink" title="创建索引别名"></a>创建索引别名</h3><p>建表时直接声明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">PUT movie_chn_2020</span><br><span class="line"></span><br><span class="line">&#123; &quot;aliases&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;movie_chn_2020-query&quot;: &#123;&#125;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&quot;mappings&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;movie&quot;:&#123;</span><br><span class="line"></span><br><span class="line">&quot;properties&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;id&quot;:&#123;</span><br><span class="line"></span><br><span class="line">&quot;type&quot;: &quot;long&quot;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&quot;name&quot;:&#123;</span><br><span class="line"></span><br><span class="line">&quot;type&quot;: &quot;text&quot;</span><br><span class="line"></span><br><span class="line">, &quot;analyzer&quot;: &quot;ik_smart&quot;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&quot;doubanScore&quot;:&#123;</span><br><span class="line"></span><br><span class="line">&quot;type&quot;: &quot;double&quot;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&quot;actorList&quot;:&#123;</span><br><span class="line"></span><br><span class="line">&quot;properties&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;id&quot;:&#123;</span><br><span class="line"></span><br><span class="line">&quot;type&quot;:&quot;long&quot;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&quot;name&quot;:&#123;</span><br><span class="line"></span><br><span class="line">&quot;type&quot;:&quot;keyword&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为已存在的索引增加别名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST _aliases</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;actions&quot;: [</span><br><span class="line"></span><br><span class="line">&#123; &quot;add&quot;: &#123; &quot;index&quot;: &quot;movie_chn_xxxx&quot;, &quot;alias&quot;:</span><br><span class="line">&quot;movie_chn_2020-query&quot; &#125;&#125;</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以通过加过滤条件缩小查询范围，建立一个子集视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">POST _aliases</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;actions&quot;: [</span><br><span class="line"></span><br><span class="line">&#123; &quot;add&quot;:</span><br><span class="line"></span><br><span class="line">&#123; &quot;index&quot;: &quot;movie_chn_xxxx&quot;,</span><br><span class="line"></span><br><span class="line">&quot;alias&quot;: &quot;movie_chn0919-query-zhhy&quot;,</span><br><span class="line"></span><br><span class="line">&quot;filter&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;term&quot;: &#123; &quot;actorList.id&quot;: &quot;3&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="查询别名"><a href="#查询别名" class="headerlink" title="查询别名"></a>查询别名</h3><p>与使用普通索引没有区别</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET movie_chn_2020-query&#x2F;_search</span><br></pre></td></tr></table></figure>

<h3 id="删除某个索引的别名"><a href="#删除某个索引的别名" class="headerlink" title="删除某个索引的别名"></a>删除某个索引的别名</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST _aliases</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;actions&quot;: [</span><br><span class="line"></span><br><span class="line">&#123; &quot;remove&quot;: &#123; &quot;index&quot;: &quot;movie_chn_xxxx&quot;, &quot;alias&quot;:</span><br><span class="line">&quot;movie_chn_2020-query&quot; &#125;&#125;</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="为某个别名进行无缝切换"><a href="#为某个别名进行无缝切换" class="headerlink" title="为某个别名进行无缝切换"></a>为某个别名进行无缝切换</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;_aliases</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;actions&quot;: [</span><br><span class="line"></span><br><span class="line">&#123; &quot;remove&quot;: &#123; &quot;index&quot;: &quot;movie_chn_xxxx&quot;, &quot;alias&quot;:</span><br><span class="line">&quot;movie_chn_2020-query&quot; &#125;&#125;,</span><br><span class="line"></span><br><span class="line">&#123; &quot;add&quot;: &#123; &quot;index&quot;: &quot;movie_chn_yyyy&quot;, &quot;alias&quot;:</span><br><span class="line">&quot;movie_chn_2020-query&quot; &#125;&#125;</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="查询别名列表"><a href="#查询别名列表" class="headerlink" title="查询别名列表"></a>查询别名列表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cat&#x2F;aliases?v</span><br></pre></td></tr></table></figure>

<h2 id="索引模板"><a href="#索引模板" class="headerlink" title="索引模板 "></a>索引模板 </h2><p>Index Template索引模板，顾名思义，就是创建索引的模具，其中可以定义一系列规则来帮助我们构建符合特定业务需求的索引的mappings和settings，通过使用 Index Template 可以让我们的索引具备可预知的一致性。</p>
<h3 id="常见的场景-分割索引"><a href="#常见的场景-分割索引" class="headerlink" title="常见的场景: 分割索引"></a>常见的场景: 分割索引</h3><p>分割索引就是根据时间间隔把一个业务索引切分成多个索引。比如把order_info<br>变成 order_info_20200101,order_info_20200102 …..</p>
<p>这样做的好处有两个：</p>
<p>结构变化的灵活性：因为elasticsearch不允许对数据结构进行修改。但是实际使用中索引的结构和配置难免变化，那么只要对下一个间隔的索引进行修改，原来的索引位置原状。这样就有了一定的灵活性。</p>
<p>查询范围优化：因为一般情况并不会查询全部时间周期的数据，那么通过切分索引，物理上减少了扫描数据的范围，也是对性能的优化。</p>
<h3 id="创建模板"><a href="#创建模板" class="headerlink" title="创建模板"></a>创建模板</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">PUT _template&#x2F;template_movie2020</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;index_patterns&quot;: [&quot;movie_test*&quot;],</span><br><span class="line"></span><br><span class="line">&quot;settings&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;number_of_shards&quot;: 1</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&quot;aliases&quot; : &#123;</span><br><span class="line"></span><br><span class="line">&quot;&#123;index&#125;-query&quot;: &#123;&#125;,</span><br><span class="line"></span><br><span class="line">&quot;movie_test-query&quot;:&#123;&#125;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&quot;mappings&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;_doc&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;properties&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;id&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;type&quot;: &quot;keyword&quot;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&quot;movie_name&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&quot;type&quot;: &quot;text&quot;,</span><br><span class="line"></span><br><span class="line">&quot;analyzer&quot;: &quot;ik_smart&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中 “index_patterns”: [“movie_test*”],<br>的含义就是凡是往movie_test开头的索引写入数据时，如果索引不存在，那么es会根据此模板自动建立索引。</p>
<blockquote>
<p>在 “aliases” 中用{index}表示，获得真正的创建的索引名。</p>
<p>测试</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST movie_test_2020xxxx&#x2F;_doc</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;id&quot;:&quot;333&quot;,</span><br><span class="line"></span><br><span class="line">&quot;name&quot;:&quot;zhang3&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="查看系统中已有的模板清单"><a href="#查看系统中已有的模板清单" class="headerlink" title="查看系统中已有的模板清单"></a>查看系统中已有的模板清单</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cat&#x2F;templates</span><br></pre></td></tr></table></figure>



<h3 id="查看某个模板详情"><a href="#查看某个模板详情" class="headerlink" title="查看某个模板详情"></a>查看某个模板详情</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _template&#x2F;template_movie2020</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _template&#x2F;template_movie*</span><br></pre></td></tr></table></figure>



<h2 id="API操作"><a href="#API操作" class="headerlink" title="API操作"></a>API操作</h2><p>新建工程并导入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpmime<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.searchbox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jest<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.java.dev.jna<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jna<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.janino<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-compiler<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>6.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="写数据"><a href="#写数据" class="headerlink" title="写数据"></a>写数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建ES客户端连接池</span></span><br><span class="line"></span><br><span class="line">JestClientFactory factory = <span class="keyword">new</span> JestClientFactory();</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.创建ES客户端连接地址</span></span><br><span class="line"></span><br><span class="line">HttpClientConfig httpClientConfig = <span class="keyword">new</span></span><br><span class="line">HttpClientConfig.Builder(<span class="string">"http://hadoop102:9200"</span>).build();</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.设置ES连接地址</span></span><br><span class="line"></span><br><span class="line">factory.setHttpClientConfig(httpClientConfig);</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.获取ES客户端连接</span></span><br><span class="line"></span><br><span class="line">JestClient jestClient = factory.getObject();</span><br><span class="line"></span><br><span class="line"><span class="comment">//5.构建ES插入数据对象</span></span><br><span class="line"></span><br><span class="line">Index index = <span class="keyword">new</span> Index.Builder(<span class="string">"&#123;n"</span> +</span><br><span class="line"></span><br><span class="line"><span class="string">" "</span>name<span class="string">":"</span>zhangsan<span class="string">",n"</span> +</span><br><span class="line"></span><br><span class="line"><span class="string">" "</span>age<span class="string">":17n"</span> +</span><br><span class="line"></span><br><span class="line"><span class="string">"&#125;"</span>).index(<span class="string">"test5"</span>).type(<span class="string">"_doc"</span>).id(<span class="string">"2"</span>).build();</span><br><span class="line"></span><br><span class="line"><span class="comment">//6.执行插入数据操作</span></span><br><span class="line"></span><br><span class="line">jestClient.execute(index);</span><br><span class="line"></span><br><span class="line"><span class="comment">//7.关闭连接</span></span><br><span class="line"></span><br><span class="line">jestClient.shutdownClient();</span><br></pre></td></tr></table></figure>

<h3 id="读数据"><a href="#读数据" class="headerlink" title="读数据"></a>读数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建ES客户端连接池</span></span><br><span class="line"></span><br><span class="line">JestClientFactory factory = <span class="keyword">new</span> JestClientFactory();</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.创建ES客户端连接地址</span></span><br><span class="line"></span><br><span class="line">HttpClientConfig httpClientConfig = <span class="keyword">new</span></span><br><span class="line">HttpClientConfig.Builder(<span class="string">"http://hadoop102:9200"</span>).build();</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.设置ES连接地址</span></span><br><span class="line"></span><br><span class="line">factory.setHttpClientConfig(httpClientConfig);</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.获取ES客户端连接</span></span><br><span class="line"></span><br><span class="line">JestClient jestClient = factory.getObject();</span><br><span class="line"></span><br><span class="line"><span class="comment">//5.构建查询数据对象</span></span><br><span class="line"></span><br><span class="line">Search search = <span class="keyword">new</span> Search.Builder(<span class="string">"&#123;n"</span> +</span><br><span class="line"></span><br><span class="line"><span class="string">" "</span>query<span class="string">": &#123;n"</span> +</span><br><span class="line"></span><br><span class="line"><span class="string">" "</span>match<span class="string">": &#123;n"</span> +</span><br><span class="line"></span><br><span class="line"><span class="string">" "</span>name<span class="string">": "</span>zhangsan<span class="string">"n"</span> +</span><br><span class="line"></span><br><span class="line"><span class="string">" &#125;n"</span> +</span><br><span class="line"></span><br><span class="line"><span class="string">" &#125;n"</span> +</span><br><span class="line"></span><br><span class="line"><span class="string">"&#125;"</span>).addIndex(<span class="string">"test5"</span>).addType(<span class="string">"_doc"</span>).build();</span><br><span class="line"></span><br><span class="line"><span class="comment">//6.执行查询操作</span></span><br><span class="line"></span><br><span class="line">SearchResult searchResult = jestClient.execute(search);</span><br><span class="line"></span><br><span class="line"><span class="comment">//7.解析查询结果</span></span><br><span class="line"></span><br><span class="line">System.out.println(searchResult.getTotal());</span><br><span class="line"></span><br><span class="line">List&lt;SearchResult.Hit&lt;Map, Void&gt;&gt; hits =</span><br><span class="line">searchResult.getHits(Map<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (SearchResult.Hit&lt;Map, Void&gt; hit : hits) &#123;</span><br><span class="line"></span><br><span class="line">System.out.println(hit.index + <span class="string">"--"</span> + hit.id);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//8.关闭连接</span></span><br><span class="line"></span><br><span class="line">jestClient.shutdownClient();</span><br></pre></td></tr></table></figure>



<h1 id="Kibana"><a href="#Kibana" class="headerlink" title="Kibana"></a>Kibana</h1><p>Kibana的安装</p>
<p>将kibana压缩包上传到虚拟机指定目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[red@hadoop102 software]$ tar -zxvf kibana-6.6.0-linux-x86_64.tar.gz -C &#x2F;opt&#x2F;module&#x2F;</span><br></pre></td></tr></table></figure>

<p>修改相关配置，连接Elasticsearch</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[red@hadoop102 kibana]$ vi config&#x2F;kibana.yml</span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Kibana is served by a back end server. This setting specifies the</span></span><br><span class="line"><span class="string">port</span> <span class="string">to</span> <span class="string">use.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server.port:</span> <span class="number">5601</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specifies the address to which the Kibana server will bind. IP</span></span><br><span class="line"><span class="string">addresses</span> <span class="string">and</span> <span class="string">host</span> <span class="string">names</span> <span class="string">are</span> <span class="string">both</span> <span class="string">valid</span> <span class="string">values.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The default is 'localhost', which usually means remote machines</span></span><br><span class="line"><span class="string">will</span> <span class="string">not</span> <span class="string">be</span> <span class="string">able</span> <span class="string">to</span> <span class="string">connect.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># To allow connections from remote users, set this parameter to a</span></span><br><span class="line"><span class="string">non-loopback</span> <span class="string">address.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server.host:</span> <span class="string">"192.168.9.102"</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span> <span class="string">...</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span> <span class="string">...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The URL of the Elasticsearch instance to use for all your queries.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">elasticsearch.url:</span> <span class="string">"http://192.168.9.102:9200"</span></span><br></pre></td></tr></table></figure>

<p>启动Kibana</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[red@hadoop102 kibana]$ bin&#x2F;kibana</span><br></pre></td></tr></table></figure>

<p><img src="/bigdata/ElasticSearch%E4%BB%8B%E7%BB%8D/%E5%9B%BE%E7%89%874.png" alt="图片4"></p>
<p>修改之前的ES启动脚本为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">es_home=/opt/module/elasticsearch</span><br><span class="line"></span><br><span class="line">kibana_home=/opt/module/kibana</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line"><span class="string">"start"</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> hadoop102 hadoop103 hadoop104</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"==============<span class="variable">$i</span>=============="</span></span><br><span class="line"></span><br><span class="line">ssh <span class="variable">$i</span> <span class="string">"source /etc/profile;<span class="variable">$&#123;es_home&#125;</span>/bin/elasticsearch &gt;/dev/null</span></span><br><span class="line"><span class="string">2&gt;&amp;1 &amp;"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">nohup <span class="variable">$&#123;kibana_home&#125;</span>/bin/kibana &gt; kibana.log 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line">&#125;;;</span><br><span class="line"></span><br><span class="line"><span class="string">"stop"</span>) &#123;</span><br><span class="line"></span><br><span class="line">ps -ef | grep <span class="variable">$&#123;kibana_home&#125;</span> | grep -v grep | awk <span class="string">'&#123;print $2&#125;'</span>|</span><br><span class="line">xargs <span class="built_in">kill</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> hadoop102 hadoop103 hadoop104</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"==============<span class="variable">$i</span>=============="</span></span><br><span class="line"></span><br><span class="line">ssh <span class="variable">$i</span> <span class="string">"ps -ef|grep <span class="variable">$es_home</span> |grep -v grep|awk '&#123;print</span></span><br><span class="line"><span class="string"><span class="variable">$2</span>&#125;'|xargs kill"</span> &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">&#125;;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Snow Monster</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://www.red0819.top/bigdata/ElasticSearch%E4%BB%8B%E7%BB%8D/">http://www.red0819.top/bigdata/ElasticSearch%E4%BB%8B%E7%BB%8D/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.red0819.top" target="_blank">RedLeavesBlog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ElasticSearch/">ElasticSearch</a></div><div class="post_share"><div class="social-share" data-image="/wordPic/timg.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/computernetwork/Sockecket%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/"><img class="prev-cover" src="/wordPic/timg.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Socket入门介绍</div></div></a></div><div class="next-post pull-right"><a href="/bigdata/Oozie%E7%AE%80%E4%BB%8B/"><img class="next-cover" src="/wordPic/oozie-logo.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Oozie简介</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></article></main><footer id="footer" style="background-image: url(/wordPic/timg.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2017 - 2020 By Snow Monster</div><div class="framework-info"><span>框架 </span><a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener">Butterfly</a></div><div class="footer_custom_text">努力充实自己大脑中，欢迎投喂知识！</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const initData = {
      el: '#vcomment',
      appId: 'BlwHhRwsSAJShGHGJeX8d6qB-gzGzoHsz',
      appKey: 'fGlkNKWjBKmGkMSND7jvpsRI',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }

    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script></div></body></html>